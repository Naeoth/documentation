<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>Launch the worker locally</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="..//javascripts/steps.js"></script>
<script type="text/javascript" src="..//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src="..//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src="..//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src="..//javascripts/tabcontainer.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
/> -->
<link rel="stylesheet" type="text/css" href="..//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href="..//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href="..//styles/steps.css" />
<link rel="stylesheet" type="text/css" href="..//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href="..//styles/sourcecode/highlight-lines.css" />
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_launch_the_worker_locally">Launch the worker locally</a></li>
<li><a href="#_interaction_with_worker">Interaction with worker</a></li>
<li><a href="#_test_you_application_locally">Test you application locally</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Once we have our <em>custom cloud service</em>, we need to create the frontend of our application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_launch_the_worker_locally"><a class="anchor" href="#_launch_the_worker_locally"></a>Launch the worker locally</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When we working on the frontend part, we often want to test our interaction with the backend logic.
So with ZetaPush, you can launch your worker locally to test this interaction.
To do this you need to use the <em>CLI</em> and run : <code>zeta run</code>.
But in this project, the <em>CLI</em> is imported and a script is created with npm, so you just need to launch :</p>
</div>
<div class="listingblock">
<div class="title">Run worker locally</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="predefined">$</span> npm run start</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to install the <em>ZetaPush CLI</em> you can run <code>npm install -g @zetapush/cli</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_interaction_with_worker"><a class="anchor" href="#_interaction_with_worker"></a>Interaction with worker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now you just need to add the interaction with the <em>custom cloud service</em>. To do this, fill the file <code>front/index.js</code> :</p>
</div>
<div class="listingblock">
<div class="title">Interaction with worker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> AvengersController from <span class="string"><span class="delimiter">'</span><span class="content">./utils/controller.js</span><span class="delimiter">'</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">import</span> dom from <span class="string"><span class="delimiter">'</span><span class="content">./utils/dom.js</span><span class="delimiter">'</span></span>; <i class="conum" data-value="2"></i><b>(2)</b>

<span class="comment">// Create the ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPush.WeakClient({ <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="key">appName</span>: <span class="string"><span class="delimiter">'</span><span class="content">appName</span><span class="delimiter">'</span></span>,
});
<span class="comment">/**
 * Create service to listen incoming messages
 */</span>
const service = client.createService({
  <span class="key">Type</span>: ZetaPushPlatform.Messaging,
  <span class="key">listener</span>: {
    <span class="comment">// Listen incoming messages from the channel 'avengersChannel'</span>
    <span class="key">avengersChannel</span>: ({ data }) =&gt; controller.onAvengersMessage(data), <i class="conum" data-value="4"></i><b>(4)</b>
  },
});

const controller = <span class="keyword">new</span> AvengersController(client, dom);

(async <span class="keyword">function</span> <span class="function">main</span>() {
  <span class="comment">// Expose to template</span>
  window.<span class="predefined">$controller</span> = controller;
  <span class="comment">// Connect to ZetaPush</span>
  await client.connect();
  <span class="comment">// Notify client connected</span>
  controller.onConnectionEstablished();
})();</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the frontend logic (in the controller)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Import some utils functions</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Object to interact with the ZetaPush platform and the <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Cloud service provided by ZetaPush to listen incoming messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value <code>appName</code> in the <em>ZetaPush Client</em> is the id of your application on your ZetaPush account. When you have launch <code>zeta run</code> (or <code>npm run start</code>) you have created an anonymous account and an empty application. All this informations are stored in the file <code>.zetarc</code> just created with the same command.</p>
</div>
<div class="paragraph">
<p>Copy-past the <code>appName</code> from the <em>.zetarc</em> to your <em>ZetaPush Client</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_you_application_locally"><a class="anchor" href="#_test_you_application_locally"></a>Test you application locally</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now, you can test your application. To do this, you need to execute your frontend part locally. For example, you can use <a href="https://caddyserver.com/">Caddy Server</a>.</p>
</div>
<div class="listingblock">
<div class="title">Run locally</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>$ curl https://getcaddy.com | bash
$ cd front/
$ caddy</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Don&#8217;t forget to relaunch your worker with <code>npm run start</code> if you have stop it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you have access to your application on <code><a href="http://localhost:2015" class="bare">http://localhost:2015</a></code>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-06-06 13:36:47 CEST
</div>
</div>
</body>
</html>