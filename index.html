<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<meta name="author" content="0.0.1-SNAPSHOT">
<title>ZetaPush documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src=".//javascripts/steps.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/source-utils.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/highlight-lines.js"></script>
<script type="text/javascript" src=".//javascripts/sourcecode/collapse-lines.js"></script>
<script type="text/javascript" src=".//javascripts/tabcontainer.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/bootswatch/2.3.2/united/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-responsive.min.css"
/> -->
<link rel="stylesheet" type="text/css" href=".//styles/custom-styles.css" />
<link rel="stylesheet" type="text/css" href=".//styles/tabcontainer.css" />
<link rel="stylesheet" type="text/css" href=".//styles/steps.css" />
<link rel="stylesheet" type="text/css" href=".//styles/sourcecode/collapse-lines.css" />
<link rel="stylesheet" type="text/css" href=".//styles/sourcecode/highlight-lines.css" />
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>ZetaPush documentation</h1>
<div class="details">
<span id="author" class="author">0.0.1-SNAPSHOT</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_zetapush_celtia">1.1. ZetaPush Celtia</a></li>
<li><a href="#_sections">1.2. Sections</a></li>
<li><a href="#_contact_us">1.3. Contact us</a></li>
</ul>
</li>
<li><a href="#_tutorial">2. Tutorial</a>
<ul class="sectlevel2">
<li><a href="#_use_case">2.1. Use case</a></li>
<li><a href="#_initialize_your_application">2.2. Initialize your application</a></li>
<li><a href="#_create_your_business_logic">2.3. Create your business logic</a>
<ul class="sectlevel4">
<li><a href="#_import_em_cloud_services_em_and_define_constants">2.3.1. Import <em>cloud services</em> and define constants</a></li>
<li><a href="#_create_the_class_with_its_constructor">2.3.2. Create the class with its constructor</a></li>
<li><a href="#_create_the_chat">2.3.3. Create the chat</a></li>
<li><a href="#_add_user_in_the_conversation">2.3.4. Add user in the conversation</a></li>
<li><a href="#_send_a_message">2.3.5. Send a message</a></li>
<li><a href="#_get_all_messages">2.3.6. Get all messages</a></li>
<li><a href="#_export_our_class">2.3.7. Export our class</a></li>
</ul>
</li>
<li><a href="#_use_your_em_custom_cloud_services_em">2.4. Use your <em>custom cloud services</em></a>
<ul class="sectlevel4">
<li><a href="#_launch_the_worker_locally">2.4.1. Launch the worker locally</a></li>
<li><a href="#_interaction_with_worker">2.4.2. Interaction with worker</a></li>
<li><a href="#_test_you_application_locally">2.4.3. Test you application locally</a></li>
</ul>
</li>
<li><a href="#_deploy_your_application">2.5. Deploy your application</a></li>
</ul>
</li>
<li><a href="#_user_manual">3. User manual</a>
<ul class="sectlevel3">
<li><a href="#_vocabulary">3.1. Vocabulary</a></li>
<li><a href="#_create_a_new_application">3.2. Create a new application</a>
<ul class="sectlevel3">
<li><a href="#_initialization_with_the_cli">3.2.1. Initialization with the CLI</a></li>
</ul>
</li>
<li><a href="#_manual_introduction">3.3. Manual introduction</a>
<ul class="sectlevel3">
<li><a href="#_what_do_we_need_to_do">3.3.1. What do we need to do ?</a></li>
<li><a href="#_details_by_file">3.3.2. Details by file</a></li>
</ul>
</li>
<li><a href="#_custom_cloud_service">3.4. Custom Cloud Service</a>
<ul class="sectlevel3">
<li><a href="#_what_is_a_em_custom_cloud_service_em">3.4.1. What is a <em>custom cloud service</em></a></li>
<li><a href="#_how_to_create_a_em_custom_cloud_service_em">3.4.2. How to create a <em>custom cloud service</em></a></li>
<li><a href="#_use_a_em_cloud_service_em_inside_my_em_custom_cloud_service_em">3.4.3. Use a <em>cloud service</em> inside my <em>custom cloud service</em></a></li>
<li><a href="#_use_an_other_em_custom_cloud_service_em_in_my_own">3.4.4. Use an other <em>custom cloud service</em> in my own</a></li>
<li><a href="#_expose_my_em_custom_cloud_services_em">3.4.5. Expose my <em>custom cloud services</em></a></li>
<li><a href="#_complete_example">3.4.6. Complete example</a></li>
</ul>
</li>
<li><a href="#_use_services">3.5. Use services</a>
<ul class="sectlevel3">
<li><a href="#_requirements">3.5.1. Requirements</a></li>
<li><a href="#_use_a_service">3.5.2. Use a service</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a><a class="link" href="#_introduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zetapush_celtia"><a class="anchor" href="#_zetapush_celtia"></a><a class="link" href="#_zetapush_celtia">1.1. ZetaPush Celtia</a></h3>
<div class="paragraph">
<p>TODO: Write presentation</p>
</div>
</div>
<div class="sect2">
<h3 id="_sections"><a class="anchor" href="#_sections"></a><a class="link" href="#_sections">1.2. Sections</a></h3>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_tutorial">Tutorial</a><br>
If you want to learn how to use ZetaPush Celtia, you can begin here</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_manual_introduction">Manual introduction</a><br>
How to start an application without CLI</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#_command_line_interface_cli">Command Line Interface</a><br>
How to use the ZetaPush CLI</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_contact_us"><a class="anchor" href="#_contact_us"></a><a class="link" href="#_contact_us">1.3. Contact us</a></h3>
<div class="paragraph">
<p>You can contact us at <a href="mailto:contact@zetapush.com">contact@zetapush.com</a>.</p>
</div>
<div class="paragraph">
<p>You can also follow our open specifications on GitHub : <a href="https://github.com/zetapush/zetapush-next-open-specification">Specs</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial"><a class="anchor" href="#_tutorial"></a><a class="link" href="#_tutorial">2. Tutorial</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this tutorial, you will create an application with ZetaPush, from the initialization to the deployment.
You will learn to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add business logic with ZetaPush</p>
</li>
<li>
<p>Use <em>cloud services</em> provided by ZetaPush</p>
</li>
<li>
<p>Run your code locally</p>
</li>
<li>
<p>Deploy your application</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_use_case"><a class="anchor" href="#_use_case"></a><a class="link" href="#_use_case">2.1. Use case</a></h3>
<div class="paragraph">
<p>You will create a realtime chat application, but it will be particular : This will be an <strong>Avengers Chat</strong> !</p>
</div>
<div class="paragraph">
<p>At the beginning, the user of the chat can choose an Avenger. Each character has many skills and they can use them on the chat to attack the others Avengers.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. List of skills by Avenger</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">Avenger</th>
<th class="tableblock halign-center valign-middle">Skill</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Captain America</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Shoot of shield / Cure</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Falcon</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Archery / Super vision</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Iron Man</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Flight / Missile launcher</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Hulk</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Punch / Regeneration</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Thor</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Hammer hit / Lightning strike</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Spider Man</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Shoot of cobweb / Jump with cobweb</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Wolverine</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Scratch / Regeneration</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You will create this application in few steps :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#_initialize_your_application">Initialize a new application</a></p>
</li>
<li>
<p><a href="#_create_your_business_logic">Create the business logic in a <em>custom cloud service</em></a></p>
</li>
<li>
<p><a href="#_use_your_em_custom_cloud_services_em">Use your <em>custom cloud service</em> in your UI</a></p>
</li>
<li>
<p><a href="#_deploy_your_application">Deploy your application</a></p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_initialize_your_application"><a class="anchor" href="#_initialize_your_application"></a><a class="link" href="#_initialize_your_application">2.2. Initialize your application</a></h3>
<div class="paragraph">
<p>In this tutorial, we are focusing on the ZetaPush development. So to begin, you need to clone the repository <strong>zetapush-tutorials</strong>, go to the tutorial <strong>avengersChat</strong> and install all dependencies :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>$ git clone git@github.com:zetapush/zetapush-tutorials.git
$ cd zetapush-tutorials/avengersChat/
$ npm install</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The repository <em>zetapush-tutorials</em> contains all tutorials on ZetaPush
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So you already have the style and the frontend logic in the folders <code>assets</code> and <code>utils</code>. You can browse this files to understand this code.</p>
</div>
<div class="paragraph">
<p>In this tutorial, you need to :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the business logic with a <em>custom cloud service</em></p>
</li>
<li>
<p>Implement the interaction with the <em>custom cloud service</em> (front side)</p>
</li>
<li>
<p>Deploy your application</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_your_business_logic"><a class="anchor" href="#_create_your_business_logic"></a><a class="link" href="#_create_your_business_logic">2.3. Create your business logic</a></h3>
<div class="paragraph">
<p>Now, you will create the business logic of your application. To do this, you will use a <em>custom cloud service</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <em>custom cloud service</em> is a class where you develop a business logic. You can create several <em>custom cloud services</em> inside one application. Each <em>custom cloud service</em> can use the <em>cloud services</em> provided by ZetaPush.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In your existing application you already have a <em>custom cloud service</em> on the file <code>worker/index.js</code> (Defined in the <code>package.json</code> with the property <code>main</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When you create one or many <em>custom cloud services</em>, you need to export them (to use them from the front side). The exportation need to be done in a file of your application, defined in the <code>package.json</code>. The property <code>main</code> defines this file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can fill this file (<code>worker/index.js</code>) with the following content :</p>
</div>
<div class="sect4">
<h5 id="_import_em_cloud_services_em_and_define_constants"><a class="anchor" href="#_import_em_cloud_services_em_and_define_constants"></a><a class="link" href="#_import_em_cloud_services_em_and_define_constants">2.3.1. Import <em>cloud services</em> and define constants</a></h5>
<div class="paragraph">
<p>First, you need to import the <em>cloud services</em> provided by ZetaPush, used in this application :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Stack</em> (Save data in a stack)</p>
</li>
<li>
<p><em>Messaging</em> (Send and receive messages)</p>
</li>
<li>
<p><em>GroupManagement</em> (Manage group of users)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You also need to import <em>Inject</em> that is useful for the dependencies injection.</p>
</div>
<div class="listingblock">
<div class="title">Imports and constants</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>const { Stack, Messaging, GroupManagement, Inject } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>);

const CONVERSATION_ID = <span class="string"><span class="delimiter">'</span><span class="content">avengersChat</span><span class="delimiter">'</span></span>;
const CHANNEL_MESSAGING = <span class="string"><span class="delimiter">'</span><span class="content">avengersChannel</span><span class="delimiter">'</span></span>; <i class="conum" data-value="1"></i><b>(1)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>On which channel the users send and listen the messages</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_create_the_class_with_its_constructor"><a class="anchor" href="#_create_the_class_with_its_constructor"></a><a class="link" href="#_create_the_class_with_its_constructor">2.3.2. Create the class with its constructor</a></h5>
<div class="paragraph">
<p>A <em>custom cloud service</em> is a class, so you need to create it.</p>
</div>
<div class="listingblock">
<div class="title">Class and constructor</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> AvengersApi {
  <span class="comment">/**
   * Dependencies injection of cloud services
   */</span>
  <span class="reserved">static</span> get parameters() { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">return</span> [
      <span class="keyword">new</span> Inject(Stack),
      <span class="keyword">new</span> Inject(Messaging),
      <span class="keyword">new</span> Inject(GroupManagement)
    ]
  }

  <span class="comment">/**
   * Constructor of our API
   */</span>
  constructor(stack, messaging, groups) { <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="local-variable">this</span>.stack = stack;
    <span class="local-variable">this</span>.messaging = messaging;
    <span class="local-variable">this</span>.groups = groups;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Syntax of dependencies injection based on <code>injection-js</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>You need to put the injected <em>cloud services</em> in the constructor in the same order that they are defined in the static method <code>parameters</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependencies injection of ZetaPush use <code>injection-js</code>. So we use the same syntax (static method <em>parameters</em>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_create_the_chat"><a class="anchor" href="#_create_the_chat"></a><a class="link" href="#_create_the_chat">2.3.3. Create the chat</a></h5>
<div class="paragraph">
<p>To create our chat, we use the <em>GroupManagement cloud service</em> provided by ZetaPush. The created group includes all users of the conversation.
So we add a method in our class to create this conversation.</p>
</div>
<div class="listingblock">
<div class="title">Create conversation</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre><span class="comment">/**
 * Create the conversation of the chat, if doesn't already exists
 */</span>
async createConversation() {
    const { exists } = await <span class="local-variable">this</span>.groups.exists({
        <span class="key">group</span>: CONVERSATION_ID
    });
    <span class="keyword">if</span> (!exists) {
        await <span class="local-variable">this</span>.groups.createGroup({
            <span class="key">group</span>: CONVERSATION_ID
        });
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_add_user_in_the_conversation"><a class="anchor" href="#_add_user_in_the_conversation"></a><a class="link" href="#_add_user_in_the_conversation">2.3.4. Add user in the conversation</a></h5>
<div class="paragraph">
<p>When an user come to the chat, we need to add it to the conversation.
So we create a method in our class to add the current user in the conversation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
</pre></td>
  <td class="code"><pre><span class="comment">/**
* Add the current user in the conversation
*/</span>
async addMeToConversation(parameters, context) { <i class="conum" data-value="1"></i><b>(1)</b>
    const output = await <span class="local-variable">this</span>.groups.addUser({
        <span class="key">group</span>: CONVERSATION_ID,
        <span class="key">user</span>: context.owner <i class="conum" data-value="2"></i><b>(2)</b>
    });
    <span class="keyword">return</span> output;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Each <em>cloud function</em> in a <em>custom cloud function</em> takes only one parameter. The second is the context, injected by the SDK</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We get the caller (owner) of the <em>cloud function</em> from the context.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_send_a_message"><a class="anchor" href="#_send_a_message"></a><a class="link" href="#_send_a_message">2.3.5. Send a message</a></h5>
<div class="paragraph">
<p>No we want to send a message on our chat. To do this, we need to follow 3 steps :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Get all users in the conversation</p>
</li>
<li>
<p>Send the message of all users in the conversation</p>
</li>
<li>
<p>Store the message in a stack</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td>
  <td class="code"><pre><span class="comment">/**
* Send a message on the chat
* @param {Object} message
*/</span>
async sendMessage(message = {}) {
    <span class="comment">// Get all users inside the conversation</span>
    const group = await <span class="local-variable">this</span>.groups.groupUsers({
      <span class="key">group</span>: CONVERSATION_ID
    });
    const users = group.users;

    <span class="comment">// Send the message to each user in the conversation</span>
    <span class="local-variable">this</span>.messaging.send({
      <span class="key">target</span>: users,
      <span class="key">channel</span>: CHANNEL_MESSAGING,
      <span class="key">data</span>: { message }
    });

    <span class="comment">// Store the message in a stack</span>
    await <span class="local-variable">this</span>.stack.push({
      <span class="key">stack</span>: CONVERSATION_ID,
      <span class="key">data</span>: message
    });

    <span class="keyword">return</span> group;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There is no specific method to launch an attack, to do this, we only send a specific message throught <code>sendMessage</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_get_all_messages"><a class="anchor" href="#_get_all_messages"></a><a class="link" href="#_get_all_messages">2.3.6. Get all messages</a></h5>
<div class="paragraph">
<p>To complete our business logic, we need to have an other method in our class to get all messages (when we enter in the chat).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre><span class="comment">/**
* Get all messages in the conversation
*/</span>
async getMessages() {
    const { result } = await <span class="local-variable">this</span>.stack.list({
      <span class="key">stack</span>: CONVERSATION_ID
    });
    <span class="keyword">return</span> result;
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_export_our_class"><a class="anchor" href="#_export_our_class"></a><a class="link" href="#_export_our_class">2.3.7. Export our class</a></h5>
<div class="paragraph">
<p>At the end, we need to export our class to use it from the front side. To do this, we only need to add this line at the end of our file :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>module.exports = AvengersApi;</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now your <em>custom cloud service</em> is ready !</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_your_em_custom_cloud_services_em"><a class="anchor" href="#_use_your_em_custom_cloud_services_em"></a><a class="link" href="#_use_your_em_custom_cloud_services_em">2.4. Use your <em>custom cloud services</em></a></h3>
<div class="paragraph">
<p>Once we have our <em>custom cloud service</em>, we need to create the frontend of our application.</p>
</div>
<div class="sect4">
<h5 id="_launch_the_worker_locally"><a class="anchor" href="#_launch_the_worker_locally"></a><a class="link" href="#_launch_the_worker_locally">2.4.1. Launch the worker locally</a></h5>
<div class="paragraph">
<p>When we working on the frontend part, we often want to test our interaction with the backend logic.
So with ZetaPush, you can launch your worker locally to test this interaction.
To do this you need to use the <em>CLI</em> and run : <code>zeta run</code>.
But in this project, the <em>CLI</em> is imported and a script is created with npm, so you just need to launch :</p>
</div>
<div class="listingblock">
<div class="title">Run worker locally</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><span class="predefined">$</span> npm run start</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to install the <em>ZetaPush CLI</em> you can run <code>npm install -g @zetapush/cli</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_interaction_with_worker"><a class="anchor" href="#_interaction_with_worker"></a><a class="link" href="#_interaction_with_worker">2.4.2. Interaction with worker</a></h5>
<div class="paragraph">
<p>Now you just need to add the interaction with the <em>custom cloud service</em>. To do this, fill the file <code>front/index.js</code> :</p>
</div>
<div class="listingblock">
<div class="title">Interaction with worker</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span class="reserved">import</span> AvengersController from <span class="string"><span class="delimiter">'</span><span class="content">./utils/controller.js</span><span class="delimiter">'</span></span>; <i class="conum" data-value="1"></i><b>(1)</b>
<span class="reserved">import</span> dom from <span class="string"><span class="delimiter">'</span><span class="content">./utils/dom.js</span><span class="delimiter">'</span></span>; <i class="conum" data-value="2"></i><b>(2)</b>

<span class="comment">// Create the ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPush.WeakClient({ <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="key">appName</span>: <span class="string"><span class="delimiter">'</span><span class="content">appName</span><span class="delimiter">'</span></span>,
});
<span class="comment">/**
 * Create service to listen incoming messages
 */</span>
const service = client.createService({
  <span class="key">Type</span>: ZetaPushPlatform.Messaging,
  <span class="key">listener</span>: {
    <span class="comment">// Listen incoming messages from the channel 'avengersChannel'</span>
    <span class="key">avengersChannel</span>: ({ data }) =&gt; controller.onAvengersMessage(data), <i class="conum" data-value="4"></i><b>(4)</b>
  },
});

const controller = <span class="keyword">new</span> AvengersController(client, dom);

(async <span class="keyword">function</span> <span class="function">main</span>() {
  <span class="comment">// Expose to template</span>
  window.<span class="predefined">$controller</span> = controller;
  <span class="comment">// Connect to ZetaPush</span>
  await client.connect();
  <span class="comment">// Notify client connected</span>
  controller.onConnectionEstablished();
})();</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the frontend logic (in the controller)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Import some utils functions</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Object to interact with the ZetaPush platform and the <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Cloud service provided by ZetaPush to listen incoming messages</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value <code>appName</code> in the <em>ZetaPush Client</em> is the id of your application on your ZetaPush account. When you have launch <code>zeta run</code> (or <code>npm run start</code>) you have created an anonymous account and an empty application. All this informations are stored in the file <code>.zetarc</code> just created with the same command.</p>
</div>
<div class="paragraph">
<p>Copy-past the <code>appName</code> from the <em>.zetarc</em> to your <em>ZetaPush Client</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_test_you_application_locally"><a class="anchor" href="#_test_you_application_locally"></a><a class="link" href="#_test_you_application_locally">2.4.3. Test you application locally</a></h5>
<div class="paragraph">
<p>Now, you can test your application. To do this, you need to execute your frontend part locally. For example, you can use <a href="https://caddyserver.com/">Caddy Server</a>.</p>
</div>
<div class="listingblock">
<div class="title">Run locally</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre>$ curl https://getcaddy.com | bash
$ cd front/
$ caddy</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Don&#8217;t forget to relaunch your worker with <code>npm run start</code> if you have stop it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then you have access to your application on <code><a href="http://localhost:2015" class="bare">http://localhost:2015</a></code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_deploy_your_application"><a class="anchor" href="#_deploy_your_application"></a><a class="link" href="#_deploy_your_application">2.5. Deploy your application</a></h3>
<div class="paragraph">
<p>Your application is working but only locally. To deploy your application you just need to launch <code>zeta push</code>. In this application you already have a npm script so you can run :</p>
</div>
<div class="listingblock">
<div class="title">Deploy the application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm run deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command deploys all in once (Front and Worker). It will return you an unique URL to access to your application.</p>
</div>
<div class="paragraph">
<p>Enjoy ! Your Avengers Chat is working and deployed !</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_manual"><a class="anchor" href="#_user_manual"></a><a class="link" href="#_user_manual">3. User manual</a></h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_vocabulary"><a class="anchor" href="#_vocabulary"></a><a class="link" href="#_vocabulary">3.1. Vocabulary</a></h4>
<div class="sect5">
<h6 id="_worker"><a class="anchor" href="#_worker"></a><a class="link" href="#_worker">Worker</a></h6>

</div>
</div>
<div class="sect2">
<h3 id="_create_a_new_application"><a class="anchor" href="#_create_a_new_application"></a><a class="link" href="#_create_a_new_application">3.2. Create a new application</a></h3>
<div class="sect3">
<h4 id="_initialization_with_the_cli"><a class="anchor" href="#_initialization_with_the_cli"></a><a class="link" href="#_initialization_with_the_cli">3.2.1. Initialization with the CLI</a></h4>
<div class="paragraph">
<p>You can generate a classic application with the following command :</p>
</div>
<div class="listingblock">
<div class="title">Generate application</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm init @zetapush myApp <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><em>myApp</em> is the name of my generated application</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This command works only with npm &gt;= 6. Otherwise, read this <a href="#_using_npm_lower_than_6">section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This command generate a tree structure of a classic application :</p>
</div>
<div class="listingblock">
<div class="title">Generated tree structure</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">myApp
├── .zetarc
├── .gitignore
├── front
│   ├── index.html
│   └── index.js
├── worker
│   └── index.js
├── README.md
└── package.json</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
All dependencies are installed, so you already can launch <code>zeta run worker</code> or <code>zeta push</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many files are created, you can see the role of each file in the following table :</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Definition of generated files</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">File / Folder</th>
<th class="tableblock halign-center valign-middle">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>.zetarc</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Contains the developer credentials. Useful to deploy or run your code. This content is auto generated if the file is empty.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>.gitignore</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Avoid you to publish you developer credentials</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>package.json</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Contains the dependencies of ZetaPush, the name of your app, the entry point of yours <em>custom cloud services</em> and many useful other informations for your application.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>README.md</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">Give you some informations to deploy or run your application.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>front/</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">By convention, the front side code of your application is in this folder. You can change it by editing <code>package.json</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>worker/</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">By convention, the back side code of your application is in this folder. You can change it by editing <code>package.json</code>.</p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_using_npm_lower_than_6"><a class="anchor" href="#_using_npm_lower_than_6"></a><a class="link" href="#_using_npm_lower_than_6">Using npm lower than 6</a></h6>
<div class="paragraph">
<p>If you using npm with a version lower than 6, you can upgrade your npm version with :</p>
</div>
<div class="listingblock">
<div class="title">Upgrade npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install -g npm@latest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or use <em>npx</em> to launch the script :</p>
</div>
<div class="listingblock">
<div class="title">Launch with npx</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npx @zetapush/create myApp</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will have the same result that using the classic command.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manual_introduction"><a class="anchor" href="#_manual_introduction"></a><a class="link" href="#_manual_introduction">3.3. Manual introduction</a></h3>
<div class="sect3">
<h4 id="_what_do_we_need_to_do"><a class="anchor" href="#_what_do_we_need_to_do"></a><a class="link" href="#_what_do_we_need_to_do">3.3.1. What do we need to do ?</a></h4>
<div class="paragraph">
<p>To start a new application with ZetaPush Celtia, the easiest path is to use the <a href="#_command_line_interface_cli">CLI</a>. But you can also start your application creating each file you need.</p>
</div>
<div class="paragraph">
<p>Here the basic source tree you need to create :</p>
</div>
<div class="listingblock">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre>module.exports = <span class="reserved">class</span> Api {
  <span class="comment">/**
   * Explicit injected platform services
   * @returns {Object[]}
   */</span>
  <span class="reserved">static</span> get injected() {
    <span class="keyword">return</span> [];
  }
  <span class="comment">/**
   * Api constructor
   */</span>
  constructor() {
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">Api:constructor</span><span class="delimiter">'</span></span>)
  }

  <span class="comment">/**
   * Get an Hello World string with server side timestamp value
   * @returns {string}
   */</span>
  async hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello World from JavaScript <span class="predefined">$</span>{Date.now()}<span class="error">`</span>;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see what you need to do for each file in the following section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_details_by_file"><a class="anchor" href="#_details_by_file"></a><a class="link" href="#_details_by_file">3.3.2. Details by file</a></h4>
<div class="sect4">
<h5 id="__zetarc"><a class="anchor" href="#__zetarc"></a><a class="link" href="#__zetarc">3.3.2.1. .zetarc</a></h5>
<div class="paragraph">
<p>To specify which account (on the ZetaPush platform) you use for an application, you type the account informations in the <code>.zetarc</code>.</p>
</div>
<div class="paragraph">
<p>The format of this file is the <strong>JSON</strong>. The possible properties are below :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>developerLogin</em> : Login of the developer account on the ZetaPush platform</p>
</li>
<li>
<p><em>developerPassword</em> : Password of the developer account on the ZetaPush platform</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">.zetarc</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
</pre></td>
  <td class="code"><pre>{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">developerLogin</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user@gmail.com</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">developerPassword</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__gitignore"><a class="anchor" href="#__gitignore"></a><a class="link" href="#__gitignore">3.3.2.2. .gitignore</a></h5>
<div class="paragraph">
<p>This file is optional but it is very useful if you want to avoid to publish your account informations on <em>GitHub</em> for example.</p>
</div>
<div class="paragraph">
<p>We recommend to create a <code>.gitignore</code> file with the following content by default :</p>
</div>
<div class="listingblock">
<div class="title">.gitignore</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>.zetarc <i class="conum" data-value="1"></i><b>(1)</b>
node_modules/ <i class="conum" data-value="2"></i><b>(2)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Avoid to publish credentials</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Avoid to publish all node_modules</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_front"><a class="anchor" href="#_front"></a><a class="link" href="#_front">3.3.2.3. front</a></h5>
<div class="paragraph">
<p>By convention, the directory contains the front code. For example you can have this tree structure :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">└── front
    ├── index.html
    └── index.js</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_basic_example_of_hello_world_with_custom_cloud_service"><a class="anchor" href="#_basic_example_of_hello_world_with_custom_cloud_service"></a><a class="link" href="#_basic_example_of_hello_world_with_custom_cloud_service">Basic example of Hello World (with custom cloud service)</a></h6>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
  <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;title&gt;</span>ZetaPush SDK Examples - Worker<span class="tag">&lt;/title&gt;</span>
  <span class="tag">&lt;style&gt;</span>
<span class="inline">    <span class="tag">body</span> {
      <span class="key">font-family</span>: <span class="value">Arial</span>, <span class="value">Helvetica</span>, <span class="value">sans-serif</span>;
    }
    <span class="tag">body</span><span class="pseudo-class">::before</span> {
      <span class="key">display</span>: <span class="value">block</span>;
      <span class="key">content</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Open Your Console</span><span class="delimiter">&quot;</span></span>;
      <span class="key">background</span>: <span class="color">#000</span>;
      <span class="key">color</span>: <span class="color">#FFF</span>;
      <span class="key">position</span>: <span class="value">fixed</span>;
      <span class="key">transform</span>: <span class="error">r</span><span class="error">o</span><span class="error">t</span><span class="error">a</span><span class="error">t</span><span class="error">e</span>(<span class="float">45deg</span>) <span class="error">t</span><span class="error">r</span><span class="error">a</span><span class="error">n</span><span class="error">s</span><span class="error">l</span><span class="error">a</span><span class="error">t</span><span class="error">e</span>(<span class="float">60px</span>, <span class="float">0px</span>);
      <span class="key">right</span>: <span class="float">0</span>;
      <span class="key">top</span>: <span class="float">0</span>;
      <span class="key">height</span>: <span class="float">25px</span>;
      <span class="key">padding</span>: <span class="float">5px</span> <span class="float">30px</span>;
      <span class="key">line-height</span>: <span class="float">25px</span>;
      <span class="key">font-family</span>: <span class="value">Calibri</span>, <span class="value">Helvetica</span>, <span class="value">Arial</span>;
      <span class="key">font-weight</span>: <span class="value">bold</span>;
    }
    <span class="tag">nav</span> {
      <span class="key">display</span>: <span class="value">flex</span>;
      <span class="key">flex-direction</span>: <span class="value">column</span>;
    }
    <span class="tag">button</span>,
    <span class="tag">label</span> {
      <span class="key">margin</span>: <span class="float">0.5</span><span class="value">rem</span> <span class="float">1</span><span class="value">rem</span>;
      <span class="key">height</span>: <span class="float">5</span><span class="value">vh</span>;
      <span class="key">font-size</span>: <span class="error">c</span><span class="error">a</span><span class="error">l</span><span class="error">c</span>(<span class="float">5</span><span class="value">vh</span> / <span class="float">2</span>);
      <span class="key">background</span>: <span class="error">l</span><span class="error">i</span><span class="error">n</span><span class="error">e</span><span class="error">a</span><span class="error">r</span><span class="error">-</span><span class="error">g</span><span class="error">r</span><span class="error">a</span><span class="error">d</span><span class="error">i</span><span class="error">e</span><span class="error">n</span><span class="error">t</span>(<span class="color">rgb(216, 216, 216)</span>, <span class="color">rgb(186, 186, 186)</span>);
      <span class="key">border-color</span>: <span class="color">rgb(117, 117, 117)</span> <span class="color">rgb(107, 107, 107)</span> <span class="color">rgb(97, 97, 97)</span>;
      <span class="key">border-style</span>: <span class="value">solid</span>;
      <span class="key">border-width</span>: <span class="float">1px</span>;
      <span class="key">padding</span>: <span class="float">1px</span> <span class="float">7px</span> <span class="float">2px</span>;
      <span class="key">text-align</span>: <span class="value">center</span>;
      <span class="key">cursor</span>: <span class="value">pointer</span>;
      <span class="key">box-sizing</span>: <span class="value">border-box</span>;
      <span class="key">align-items</span>: <span class="value">flex-start</span>;
    }
    <span class="tag">button</span>[<span class="attribute-name">disabled</span>],
    <span class="tag">label</span>[<span class="attribute-name">disabled</span>] {
      <span class="key">opacity</span>: <span class="float">0.9</span>;
      <span class="key">pointer-events</span>: <span class="value">none</span>;
      <span class="key">cursor</span>: <span class="value">not-allowed</span>;
      <span class="key">color</span>: <span class="value">graytext</span>;
    }</span>
  <span class="tag">&lt;/style&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
  <span class="tag">&lt;nav&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">disabled</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">js-Hello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span>
  <span class="tag">&lt;/nav&gt;</span>
  <span class="tag">&lt;main&gt;</span>
    <span class="tag">&lt;ul&gt;</span><span class="tag">&lt;/ul&gt;</span>
  <span class="tag">&lt;/main&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/core</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/platform</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
  <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>
<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPush.WeakClient({
  <span class="key">sandboxId</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">yourappname</span><span class="delimiter">&quot;</span></span>,
});

const api = client.createProxyTaskService();

client.connect().then(() =&gt; (
  console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>),
  [...document.querySelectorAll(<span class="string"><span class="delimiter">'</span><span class="content">button</span><span class="delimiter">'</span></span>)].forEach((node) =&gt;
    node.removeAttribute(<span class="string"><span class="delimiter">'</span><span class="content">disabled</span><span class="delimiter">'</span></span>),
  )
));

document.addEventListener(<span class="string"><span class="delimiter">'</span><span class="content">DOMContentLoaded</span><span class="delimiter">'</span></span>, () =&gt; {
    document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">.js-Hello</span><span class="delimiter">'</span></span>).addEventListener(<span class="string"><span class="delimiter">'</span><span class="content">click</span><span class="delimiter">'</span></span>, (event) =&gt; {
        console.log(<span class="string"><span class="delimiter">'</span><span class="content">Hello world</span><span class="delimiter">'</span></span>, () =&gt; api.hello());
    });
});</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_worker_2"><a class="anchor" href="#_worker_2"></a><a class="link" href="#_worker_2">3.3.2.4. worker</a></h5>
<div class="paragraph">
<p>By convention, the directory contains the back code. For example you can have this tree structure :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">└── worker
    └── index.js</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_basic_example_of_hello_world_custom_cloud_service"><a class="anchor" href="#_basic_example_of_hello_world_custom_cloud_service"></a><a class="link" href="#_basic_example_of_hello_world_custom_cloud_service">Basic example of Hello World (custom cloud service)</a></h6>
<div class="listingblock">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td>
  <td class="code"><pre>module.exports = <span class="reserved">class</span> Api {
  <span class="comment">/**
   * Explicit injected platform services
   * @returns {Object[]}
   */</span>
  <span class="reserved">static</span> get injected() {
    <span class="keyword">return</span> [];
  }
  <span class="comment">/**
   * Api constructor
   */</span>
  constructor() {
    console.log(<span class="string"><span class="delimiter">'</span><span class="content">Api:constructor</span><span class="delimiter">'</span></span>)
  }

  <span class="comment">/**
   * Get an Hello World string with server side timestamp value
   * @returns {string}
   */</span>
  async hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello World from JavaScript <span class="predefined">$</span>{Date.now()}<span class="error">`</span>;
  }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_package_json"><a class="anchor" href="#_package_json"></a><a class="link" href="#_package_json">3.3.2.5. package.json</a></h5>
<div class="paragraph">
<p>The <code>package.json</code> is the most important file in the application. It contains all informations needed to deploy or run your application on the ZetaPush platform (Except the credentials of the ZetaPush account in the <code>.zetarc</code>).</p>
</div>
<div class="paragraph">
<p>The minimal <code>package.json</code> is below :</p>
</div>
<div class="listingblock">
<div class="title">package.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">worker/index.js</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/platform</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.11.1</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/cli</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.11.1</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name of your application. This is the same name that will be registered on your ZetaPush account.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Entry point of your <a href="#_worker">worker</a>. This is in this file that you will expose your <em>custom cloud services</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Dependency of the <em>ZetaPush Platform</em> to write some <em>custom cloud services</em> and access to existing <em>cloud services</em> exposed by ZetaPush</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Dependency to use the <a href="#_command_line_interface_cli">CLI</a> (Command Line Interface). It will be useful to run your worker or deploy your code.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The name of the application is important. It should be the same that the same of your application registered in your ZetaPush account. Otherwise, at the next deployment, a new application will be created with the name in the <code>package.json</code>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_path_of_the_code"><a class="anchor" href="#_path_of_the_code"></a><a class="link" href="#_path_of_the_code">Path of the code</a></h6>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By convention, ZetaPush Celtia considers that your front code is in the directory <code>front</code> and your back code (worker) in <code>worker</code>. You can change it by setting path in the <code>package.json</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is an example of application where the front code is in the directory <code>front/dist</code> and the back code in <code>server</code> :</p>
</div>
<div class="listingblock">
<div class="title">package.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre>{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">worker/index.js</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/platform</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.11.1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/cli</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.11.1</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">zetapush</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">front</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./front/dist</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">worker</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./server</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The front code to deploy is in the directory <code>front/dist</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The back code to deploy is in the directory <code>server</code></td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_install_dependencies"><a class="anchor" href="#_install_dependencies"></a><a class="link" href="#_install_dependencies">Install dependencies</a></h6>
<div class="paragraph">
<p>You need to install some dependencies in your application. To do this, you can run :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">$ npm install --save @zetapush/platform
$ npm install --save @zetapush/cli</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_cloud_service"><a class="anchor" href="#_custom_cloud_service"></a><a class="link" href="#_custom_cloud_service">3.4. Custom Cloud Service</a></h3>
<div class="sect3">
<h4 id="_what_is_a_em_custom_cloud_service_em"><a class="anchor" href="#_what_is_a_em_custom_cloud_service_em"></a><a class="link" href="#_what_is_a_em_custom_cloud_service_em">3.4.1. What is a <em>custom cloud service</em></a></h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <em>custom cloud service</em> combines many <a href="#_cloud_function">cloud functions</a> like the <em>cloud services</em> exposed by ZetaPush. The only difference is that it is <strong>you</strong> that create the <em>cloud functions</em>.
Generally, we put the <strong>business logic</strong> of your application in the <em>custom cloud services</em>.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_example"><a class="anchor" href="#_example"></a><a class="link" href="#_example">Example</a></h6>
<div class="sidebarblock">
<div class="content">
<div class="paragraph">
<p>Your use-case is a basic real-time chat between <em>characters of Avengers</em> (See <a href="#_tutorial">tutorial</a>). You create the chat with the <em>cloud services</em> provided by ZetaPush and you want to add a new feature : Each <em>Avenger</em> has many skills/attacks and they can randomly use one of them on the chat.</p>
</div>
<div class="paragraph">
<p>To add this business logic, you can create a <em>custom cloud service</em> named <em>AvengerService</em> and into this, you add a <em>cloud function</em> named <em>launchRandomAttack</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_architecture"><a class="anchor" href="#_architecture"></a><a class="link" href="#_architecture">3.4.1.2. Architecture</a></h5>
<div class="sect5">
<h6 id="_development_phase"><a class="anchor" href="#_development_phase"></a><a class="link" href="#_development_phase">Development phase</a></h6>
<div class="imageblock">
<div class="content">
<img src="custom-cloud-service-dev.png" alt="Custom Cloud Service in development phase" width="1437" height="594">
</div>
<div class="title">Figure 1. Custom Cloud Service in development phase</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The worker is running "locally" and interacts with the existing <em>cloud services</em> on the ZetaPush platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The front code interacts <strong>only</strong> with the <em>custom cloud services</em> that is running "locally"</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_production_phase"><a class="anchor" href="#_production_phase"></a><a class="link" href="#_production_phase">Production phase</a></h6>
<div class="imageblock">
<div class="content">
<img src="custom-cloud-service-prod.png" alt="Custom Cloud Service in production phase" width="352" height="377">
</div>
<div class="title">Figure 2. Custom Cloud Service in production phase</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The front code interacts <strong>only</strong> with the <em>custom cloud services</em> that is running "locally"</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_how_to_create_a_em_custom_cloud_service_em"><a class="anchor" href="#_how_to_create_a_em_custom_cloud_service_em"></a><a class="link" href="#_how_to_create_a_em_custom_cloud_service_em">3.4.2. How to create a <em>custom cloud service</em></a></h4>
<div class="paragraph">
<p>First, a <em>custom cloud service</em> is a <code>class</code> and its <code>methods</code> are the  <em>cloud functions</em>. So the most basic example of <em>custom cloud service</em> is below :</p>
</div>
<div class="sect5">
<h6 id="_create_a_em_cloud_function_em"><a class="anchor" href="#_create_a_em_cloud_function_em"></a><a class="link" href="#_create_a_em_cloud_function_em">Create a <em>cloud function</em></a></h6>
<div class="listingblock">
<div class="title">Basic custom cloud service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloWorldAsCustomCloudService {

    constructor() {} <i class="conum" data-value="1"></i><b>(1)</b>

    helloWorld() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>;
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>You always need to add a constructor in a <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>helloWorld</code> is your first <em>cloud function</em> in your <em>custom cloud service</em> named <strong>HelloWorldAsCustomCloudService</strong></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A <em>cloud function</em> is always asynchronous (with the <em>async</em> keyword or not)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each <em>cloud function</em> in a <em>custom cloud service</em> must follow a specific format.
Only the first parameter is passed, the second is the context of the call.
For example :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> myCustomCloudService {
    constructor() {}

    myCloudFunction(parameters, context) { <i class="conum" data-value="1"></i><b>(1)</b>
        ...
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>parameters</code> is the first argument passed, it can be an object.
<code>context</code> is the context of the call for this <em>cloud function</em>.
For example you can get the ID of the caller by <code>context.owner</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the front side, you can use this <em>cloud function</em> like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="local-variable">this</span>.api.myCloudFunction({ <span class="key"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">'</span><span class="content">toto</span><span class="delimiter">'</span></span>});
<span class="comment">// Or this.api.myCloudFunction('titi');</span></pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_em_cloud_service_em_inside_my_em_custom_cloud_service_em"><a class="anchor" href="#_use_a_em_cloud_service_em_inside_my_em_custom_cloud_service_em"></a><a class="link" href="#_use_a_em_cloud_service_em_inside_my_em_custom_cloud_service_em">3.4.3. Use a <em>cloud service</em> inside my <em>custom cloud service</em></a></h4>
<div class="sect5">
<h6 id="_dependencies_injection"><a class="anchor" href="#_dependencies_injection"></a><a class="link" href="#_dependencies_injection">Dependencies injection</a></h6>
<div class="paragraph">
<p>First of all, if you want to include some services (custom or not), you need to use <em>dependencies injection</em> of ZetaPush. All of your dependencies injection will be facilitated.</p>
</div>
<div class="paragraph">
<p>So, you need to import the package <code>@zetapush/platform</code> to import <code>Inject()</code>. This object will resolve the dependencies injection of <em>cloud services</em> and <em>custom cloud services</em>.</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/platform</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/platform</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependencies injection of ZetaPush use the library <strong>injection-js</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, to import an other service, you simply need to write :</p>
</div>
<div class="listingblock highlight-lines:6-11,13">
<div class="title">Import service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>const { Inject, Stack } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
const MyOtherService = require(<span class="string"><span class="delimiter">'</span><span class="content">./services.js</span><span class="delimiter">'</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>

<span class="reserved">class</span> MyOwnService {

    <span class="reserved">static</span> get parameters() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> [
            <span class="keyword">new</span> Inject(MyOtherService),
            <span class="keyword">new</span> Inject(Stack)
        ]
    }

    constructor(myOtherService, stack) { <i class="conum" data-value="4"></i><b>(4)</b>
        ...
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Inject</code> object and a service (<em>Stack</em>) provided by ZetaPush</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We import an other custom cloud service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We create a static method to implement our dependencies injection (<em>injection-js</em> syntax)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We use instances of our injected services in our service throught the constructor</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The order in your <code>parameters</code> method need to be the same in your constructor. (Here, first <em>MyOtherService</em>, then <em>Stack</em>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you import a <em>custom cloud service</em> or a <em>cloud service</em> provided by ZetaPush, you use both similary</p>
</div>
</div>
<div class="sect5">
<h6 id="_use_imported_cloud_services"><a class="anchor" href="#_use_imported_cloud_services"></a><a class="link" href="#_use_imported_cloud_services">Use imported cloud services</a></h6>
<div class="paragraph">
<p>Once you have import the services, you can use them.</p>
</div>
<div class="paragraph">
<p>In this example, we will use the <code>Stack</code> <em>cloud service</em> provided by ZetaPush.
In our use-case, we want to put some data associated with the current timestamp and be able to list all stored data.</p>
</div>
<div class="paragraph">
<p>For this the <code>Stack</code> service provides some methods :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>push({ <em>stack</em>: string, <em>data</em>: object });</p>
</li>
<li>
<p>list({ <em>stack</em>: string });</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>Stack</code> service has asynchronous methods
</td>
</tr>
</table>
</div>
<div class="listingblock highlight-lines:5-9,11,12,14">
<div class="title">MyStorageService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
  <td class="code"><pre>const { Inject, Stack } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>);

<span class="reserved">class</span> MyStorageService {

    <span class="reserved">static</span> get parameters() {
        <span class="keyword">return</span> [
            <span class="keyword">new</span> Inject(Stack) <i class="conum" data-value="1"></i><b>(1)</b>
        ]
    }

    constructor(stack) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.stack = stack;
        <span class="local-variable">this</span>.stackName = <span class="string"><span class="delimiter">'</span><span class="content">stack-example</span><span class="delimiter">'</span></span>;
    }

    <span class="comment">/**
     *  Store data with associated timestamp
     *  @param {object} value Data we want to store
     */</span>
    async storeWithTimestamp(value) {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stack.push({
            <span class="key">stack</span>: <span class="local-variable">this</span>.stackName,
            <span class="key">data</span>: {
                value,
                <span class="key">timestamp</span>: Date.now()
            }
        });
    }

    <span class="comment">/**
     * List all stored data
     */</span>
    async getAllData() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.stack.list({
            <span class="key">stack</span>: <span class="local-variable">this</span>.stackName
        });
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Stack</code> service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>stack</code> is an instance of <code>Stack</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_an_other_em_custom_cloud_service_em_in_my_own"><a class="anchor" href="#_use_an_other_em_custom_cloud_service_em_in_my_own"></a><a class="link" href="#_use_an_other_em_custom_cloud_service_em_in_my_own">3.4.4. Use an other <em>custom cloud service</em> in my own</a></h4>
<div class="sect5">
<h6 id="_dependencies_injection_2"><a class="anchor" href="#_dependencies_injection_2"></a><a class="link" href="#_dependencies_injection_2">Dependencies injection</a></h6>
<div class="paragraph">
<p>First of all, if you want to include some services (custom or not), you need to use <em>dependencies injection</em> of ZetaPush. All of your dependencies injection will be facilitated.</p>
</div>
<div class="paragraph">
<p>So, you need to import the package <code>@zetapush/platform</code> to import <code>Inject()</code>. This object will resolve the dependencies injection of <em>cloud services</em> and <em>custom cloud services</em>.</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/platform</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install --save @zetapush/platform</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The dependencies injection of ZetaPush use the library <strong>injection-js</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, to import an other service, you simply need to write :</p>
</div>
<div class="listingblock highlight-lines:6-11,13">
<div class="title">Import service</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td>
  <td class="code"><pre>const { Inject, Stack } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>); <i class="conum" data-value="1"></i><b>(1)</b>
const MyOtherService = require(<span class="string"><span class="delimiter">'</span><span class="content">./services.js</span><span class="delimiter">'</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>

<span class="reserved">class</span> MyOwnService {

    <span class="reserved">static</span> get parameters() { <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="keyword">return</span> [
            <span class="keyword">new</span> Inject(MyOtherService),
            <span class="keyword">new</span> Inject(Stack)
        ]
    }

    constructor(myOtherService, stack) { <i class="conum" data-value="4"></i><b>(4)</b>
        ...
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Inject</code> object and a service (<em>Stack</em>) provided by ZetaPush</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We import an other custom cloud service</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We create a static method to implement our dependencies injection (<em>injection-js</em> syntax)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We use instances of our injected services in our service throught the constructor</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The order in your <code>parameters</code> method need to be the same in your constructor. (Here, first <em>MyOtherService</em>, then <em>Stack</em>)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you import a <em>custom cloud service</em> or a <em>cloud service</em> provided by ZetaPush, you use both similary</p>
</div>
</div>
<div class="sect5">
<h6 id="_use_imported_custom_cloud_services"><a class="anchor" href="#_use_imported_custom_cloud_services"></a><a class="link" href="#_use_imported_custom_cloud_services">Use imported custom cloud services</a></h6>
<div class="paragraph">
<p>Once you have import the services, you can use them.</p>
</div>
<div class="paragraph">
<p>In this example, we will have 2 <em>custom cloud services</em> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Calendar</code> : Utils function to return the current date</p>
</li>
<li>
<p><code>HelloWorldService</code> : Basic example using <code>Calendar</code> <em>cloud function</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first <em>custom cloud service</em> (<code>Calendar</code>) is in the file : "worker/calendar.js".</p>
</div>
<div class="listingblock">
<div class="title">worker/calendar.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> Calendar {
    getNow() { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> Date().toLocalDateString(<span class="string"><span class="delimiter">'</span><span class="content">fr-FR</span><span class="delimiter">'</span></span>);
    }
}

module.exports = { Calendar };</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The only <em>cloud function</em> of the <code>Calendar</code> service</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, we have the <code>HelloWorldService</code> that use our <code>Calendar</code> service. It is in the file : "./worker/index.js".</p>
</div>
<div class="listingblock highlight-lines:6-10,12-14">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre>const { Inject } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>);
const { Calendar } = require(<span class="string"><span class="delimiter">'</span><span class="content">./calendar.js</span><span class="delimiter">'</span></span>);

<span class="reserved">class</span> HelloWorldService {

    <span class="reserved">static</span> get parameters() {
        <span class="keyword">return</span> [
            <span class="keyword">new</span> Inject(Calendar) <i class="conum" data-value="1"></i><b>(1)</b>
        ]
    }

    constructor(calendar) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.calendar = calendar;
    }

    <span class="comment">/**
     *  Return 'Hello World' with current date
     */</span>
    helloWorldWithDate() {
        <span class="keyword">return</span> <span class="error">`</span>Hello world at <span class="predefined">$</span>{<span class="local-variable">this</span>.calendar.getNow()}<span class="error">`</span>;
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We import the <code>Calendar</code> service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>calendar</code> is an instance of <code>Calendar</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_expose_my_em_custom_cloud_services_em"><a class="anchor" href="#_expose_my_em_custom_cloud_services_em"></a><a class="link" href="#_expose_my_em_custom_cloud_services_em">3.4.5. Expose my <em>custom cloud services</em></a></h4>
<div class="paragraph">
<p>When you create a <em>custom cloud service</em> that you want to expose to the client, you need to declare it. You have 2 cases :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only one <em>custom cloud service</em> exposed</p>
</li>
<li>
<p>Many <em>custom cloud servcies</em> exposed</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>package.json</code> has a property named <code>main</code>. It defines the file where the <em>custom cloud services</em> are exposed. The following examples define them in <code>worker/index.js</code>.
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_only_one_custom_cloud_service_exposed"><a class="anchor" href="#_only_one_custom_cloud_service_exposed"></a><a class="link" href="#_only_one_custom_cloud_service_exposed">Only one custom cloud service exposed</a></h6>
<div class="paragraph">
<p>In this example, we have 2 <em>custom cloud services</em> : One is private and the second is exposed :</p>
</div>
<div class="listingblock highlight-lines:24">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td>
  <td class="code"><pre>const { Inject } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>);

<span class="reserved">class</span> Calendar { <i class="conum" data-value="1"></i><b>(1)</b>
  getNow() {
    <span class="keyword">return</span> <span class="keyword">new</span> Date().toLocaleDateString();
  }
}

<span class="reserved">class</span> MyPublicCustomCloudService { <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="reserved">static</span> get parameters() {
    <span class="keyword">return</span> [
      <span class="keyword">new</span> Inject(Calendar)
    ];
  }
  constructor(calendar) {
    <span class="local-variable">this</span>.calendar = calendar;
  }

  async hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello World at <span class="predefined">$</span>{<span class="local-variable">this</span>.calendar.getNow()}<span class="error">`</span>;
  }
}

module.exports = MyPublicCustomCloudService; <i class="conum" data-value="3"></i><b>(3)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>Calendar</code> is my private <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>MyPublicCustomCloudService</code> is my exposed <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We expose only <code>MyPublicCustomCloudService</code> to the client side</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_many_custom_cloud_services_exposed"><a class="anchor" href="#_many_custom_cloud_services_exposed"></a><a class="link" href="#_many_custom_cloud_services_exposed">Many custom cloud services exposed</a></h6>
<div class="paragraph">
<p>In this example, we want to expose 2 <em>custom cloud services</em>. In this case, we need to specify the namespace of each <em>custom cloud service</em> :</p>
</div>
<div class="listingblock highlight-lines:24-27">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td>
  <td class="code"><pre>const { Inject } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>);

<span class="reserved">class</span> Calendar { <i class="conum" data-value="1"></i><b>(1)</b>
  getNow() {
    <span class="keyword">return</span> <span class="keyword">new</span> Date().toLocaleDateString();
  }
}

<span class="reserved">class</span> HelloService {
  <span class="reserved">static</span> get parameters() {
    <span class="keyword">return</span> [
      <span class="keyword">new</span> Inject(Calendar)
    ];
  }
  constructor(calendar) {
    <span class="local-variable">this</span>.calendar = calendar;
  }

  async hello() {
    <span class="keyword">return</span> <span class="error">`</span>Hello World at <span class="predefined">$</span>{<span class="local-variable">this</span>.calendar.getNow()}<span class="error">`</span>;
  }
}

module.exports = { <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="key">helloService</span>: HelloService,
  <span class="key">calendar</span>: Calendar
};</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No need to define <code>parameters</code> static method because we don&#8217;t expose this service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We expose the 2 <em>custom cloud services</em> to the client side with the syntax : { <em>namespace1</em> : <em>Service1</em>, <em>namespace2</em> : <em>Service2</em> }</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_complete_example"><a class="anchor" href="#_complete_example"></a><a class="link" href="#_complete_example">3.4.6. Complete example</a></h4>
<div class="paragraph">
<p>My configuration in the <code>package.json</code> is the following :</p>
</div>
<div class="listingblock">
<div class="title">package.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td>
  <td class="code"><pre>{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">worker/index.js</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">zetapush</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">front</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./front</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">worker</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">./worker</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">dependencies</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/core</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.14.1</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@zetapush/plaform</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">^0.14.1</span><span class="delimiter">&quot;</span></span>
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>And my back side code is :</p>
</div>
<div class="listingblock">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
</pre></td>
  <td class="code"><pre>const { Stack, Inject } = require(<span class="string"><span class="delimiter">'</span><span class="content">@zetapush/platform</span><span class="delimiter">'</span></span>)

<span class="reserved">class</span> DateCustomService {
    constructor() {}

    <i class="conum" data-value="1"></i><b>(1)</b>

    formatDate(date) {
        <span class="keyword">return</span> date.toLocalDateString(<span class="string"><span class="delimiter">&quot;</span><span class="content">fr-FR</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="reserved">class</span> SimpleStorageWithDate {

    <span class="reserved">static</span> get parameters() {
        <span class="keyword">return</span> [
            <span class="keyword">new</span> Inject(Stack),
            <span class="keyword">new</span> Inject(DateCustomService)
        ]
    }

    constructor(stack, dateCustomService) {
        <span class="local-variable">this</span>.stack = stack;
        <span class="local-variable">this</span>.dateCustomService = dateCustomService;
    }

    async push(item) { <i class="conum" data-value="2"></i><b>(2)</b>
        const output = await <span class="local-variable">this</span>.stack.push({ <i class="conum" data-value="3"></i><b>(3)</b>
            <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>,
            <span class="key">data</span>: {
                <span class="key">value</span>: item,
                <span class="key">date</span>: <span class="local-variable">this</span>.dateService.formateDate(<span class="keyword">new</span> Date()); <i class="conum" data-value="4"></i><b>(4)</b>
            }
        });
        <span class="keyword">return</span> const;
    }

    async list() {
        const output = await <span class="local-variable">this</span>.stack.list({ <span class="key">stack</span>: <span class="string"><span class="delimiter">'</span><span class="content">demo</span><span class="delimiter">'</span></span>});
        <span class="keyword">return</span> output;
    }
}

module.exports = SimpleStorageWithDate; <i class="conum" data-value="5"></i><b>(5)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>No need to define <code>parameters</code> static method because we don&#8217;t expose this service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Async/Await context</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Use the existing <em>cloud services</em></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Use an other <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Expose only <code>SimpleStorageWithDate</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_use_services"><a class="anchor" href="#_use_services"></a><a class="link" href="#_use_services">3.5. Use services</a></h3>
<div class="paragraph">
<p>On the front-side, you will want to use the <em>cloud services</em> provided by ZetaPush or your <em>custom cloud services</em>.
The utilization of a <em>cloud service</em> or a <em>custom cloud service</em> <strong>is exactly the same process</strong>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Currently, we can&#8217;t call a <em>cloud service</em> provided by ZetaPush from the front-end. This will be worked out very soon, and this will be the same syntax that the <em>custom cloud service</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_requirements"><a class="anchor" href="#_requirements"></a><a class="link" href="#_requirements">3.5.1. Requirements</a></h4>
<div class="paragraph">
<p>To use services (custom or not), you need to have installed the dependency of the ZetaPush Core (<code>@zetapush/core</code>).</p>
</div>
<div class="paragraph">
<p>So you can install it with :</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/core via npm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>$ npm install @zetapush/core</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="title">Install @zetapush/core via unpkg</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="console">&lt;script src=&quot;https://unpkg.com/@zetapush/core&quot;&gt;&lt;/script&gt;</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_requirements_for_em_custom_cloud_service_em"><a class="anchor" href="#_requirements_for_em_custom_cloud_service_em"></a><a class="link" href="#_requirements_for_em_custom_cloud_service_em">Requirements for <em>custom cloud service</em></a></h6>
<div class="paragraph">
<p>If you want to use a <em>custom cloud service</em>, make sure that you have exposed your service (<a href="#_expose_my_em_custom_cloud_services_em">Documentation</a>)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_use_a_service"><a class="anchor" href="#_use_a_service"></a><a class="link" href="#_use_a_service">3.5.2. Use a service</a></h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The utilization of a <em>custom cloud service</em> and a <em>cloud service</em> provided by ZetaPush is exactly the same process
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example gives a better explanation than a long speech, so here is an example of utilization of services.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you call a <em>cloud function</em>, the result is always a Promise.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In our example we use this <em>custom cloud service</em> named <code>HelloService</code> :</p>
</div>
<div class="listingblock">
<div class="title">worker/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> HelloService {
    <span class="reserved">static</span> get parameters() {
        <span class="keyword">return</span> [];
    }
    constructor() { }

    async hello() {
        <span class="keyword">return</span> <span class="error">`</span>Hello World<span class="error">`</span>;
    }
}

module.exports = HelloService; <i class="conum" data-value="1"></i><b>(1)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The service is exported</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we create the HTML page with a button to display the <em>HelloWorld</em> message in the console :</p>
</div>
<div class="listingblock">
<div class="title">front/index.html</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="html"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;html</span> <span class="attribute-name">lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;head&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;meta</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">viewport</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">width=device-width, initial-scale=1.0</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;title&gt;</span>Celtia<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/head&gt;</span>

<span class="tag">&lt;body&gt;</span>
    <span class="tag">&lt;button</span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>hello()<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>hello<span class="tag">&lt;/button&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="tag">&lt;ul&gt;</span><span class="tag">&lt;/ul&gt;</span>

    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://unpkg.com/@zetapush/core</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span> <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="tag">&lt;script</span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">./index.js</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/script&gt;</span>
<span class="tag">&lt;/body&gt;</span>

<span class="tag">&lt;/html&gt;</span></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We call <code>hello()</code> that call our <em>custom cloud service</em></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Dependency of ZetaPush Core</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we have the front-side code to call our services :</p>
</div>
<div class="listingblock">
<div class="title">front/index.js</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td>
  <td class="code"><pre><span class="comment">// Create new ZetaPush Client</span>
const client = <span class="keyword">new</span> ZetaPush.WeakClient({ <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key">appName</span>: &lt;yourAppName&gt;,
    <span class="key">platformUrl</span>: &lt;optionalUrl&gt;
});

const api = client.createProxyTaskService(); <i class="conum" data-value="2"></i><b>(2)</b>

client.connect().then(() =&gt; ( <i class="conum" data-value="3"></i><b>(3)</b>
    console.debug(<span class="string"><span class="delimiter">'</span><span class="content">onConnectionEstablished</span><span class="delimiter">'</span></span>)
));

async <span class="keyword">function</span> <span class="function">hello</span>() {
    const output = await api.hello(); <i class="conum" data-value="4"></i><b>(4)</b>

    const ul = document.querySelector(<span class="string"><span class="delimiter">'</span><span class="content">ul</span><span class="delimiter">'</span></span>);
    const fragment = document.createDocumentFragment();
    const li = document.createElement(<span class="string"><span class="delimiter">'</span><span class="content">li</span><span class="delimiter">'</span></span>);
    li.textContent = output;
    fragment.appendChild(li);
    ul.appendChild(fragment);
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Create the ZetaPush client with a specific appName and optional URL</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>API to access to our services</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Connection to the ZetaPush platform</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Call our <em>cloud function</em> and display the result</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Now when we click on the button, "Hello World" is displayed on the page.</strong></p>
</div>
<div class="sect5">
<h6 id="_namespace"><a class="anchor" href="#_namespace"></a><a class="link" href="#_namespace">Namespace</a></h6>
<div class="paragraph">
<p>When you call a <em>cloud function</em> from a <em>custom cloud service</em>, you can specified a <em>namespace</em> (if you have 2 <em>cloud functions</em> on 2 differents <em>custom cloud services</em>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>namespace</em> is never used in the <em>custom cloud service</em>. The <em>namespace</em> is defined when you expose your <em>custom cloud service</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example we have this service :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre><span class="reserved">class</span> Api {
    constructor() {}

    hello(name, context) { <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> <span class="error">`</span>Hello <span class="predefined">$</span>{name} called by <span class="predefined">$</span>{context.owner}.<span class="error">`</span>;
    }
}

module.exports = {
    <span class="key">api</span>: Api <i class="conum" data-value="2"></i><b>(2)</b>
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <em>namespace</em> is never passed here</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We export this <em>custom cloud service</em> with the namespace 'api'</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can call <code>hello()</code> like this :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="comment">// api is an instance of Api</span>
<span class="local-variable">this</span>.api.hello(<span class="string"><span class="delimiter">'</span><span class="content">Toto</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">api</span><span class="delimiter">'</span></span>); <i class="conum" data-value="1"></i><b>(1)</b></pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the method <code>hello()</code> from the namespace <em>api</em>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-06-06 12:35:24 CEST
</div>
</div>
</body>
</html>